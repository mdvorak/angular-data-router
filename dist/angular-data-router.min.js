!function(a){"use strict";function b(a,b){this.message=a,this.status=b,this.stack=(new Error).stack}function c(){return Array.prototype.join.call(arguments,"/").replace(/\/+/g,"/")}function d(a){var b=new RegExp("^"+e(a)+"$");return function(a){return b.test(a)}}function e(a){return a.replace(/([-()\[\]{}+?.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace(/[*]+/,".*")}var f=a.module("mdvorak.dataRouter",[]);f.provider("$dataRouter",["$log","$$DataRouterMatchMap",function(d,e){function f(a){return a=a.replace(/\s*[\+;].*$/,""),a.indexOf("/")<0&&(a="application/"+a),a}var g=this,h=new e,i=new e;this.$debug=!1,this.debug=function(a){g.$debug=!!a},this.$apiPrefix="api/",this.apiPrefix=function(a){"/"!==a[a.length-1]&&(a+="/"),"/"===a[0]&&(a=a.substring(1)),g.$apiPrefix=a},this.mapViewPath=function(a,b){return c(a,g.$apiPrefix,b)},this.mapApiUrl=function(a,b){return"/"!==a[a.length-1]&&(a+="/"),0===b.indexOf(a)&&(b=b.substring(a.length)),0===b.indexOf(g.$apiPrefix)?b.substring(3):void 0},this.when=function(b,c){c=a.copy(c),a.isFunction(b)?(h.addMatcher(b,c),g.$debug&&d.log("Registered content type matcher "+b.name,c)):(b=f(b),h.addMatcher(b,c),g.$debug&&d.log("Registered content type "+b,c))},this.error=function(b){h.addMatcher("$error",a.copy(b))},this.redirect=function(a,b){b&&i.addMatcher(a,b)},this.$get=["$location","$rootScope","$http","$templateCache","$sce","$q","$browser","$routeData","$injector",function(c,e,j,k,l,m,n,o,p){function q(a){var b,e=c.path()||"/";if(b=i.match(e))return g.$debug&&d.info("Redirecting to "+b),void c.path(b).replace();var h=t.mapViewPath(c.path()),k=t.next={url:h};g.$debug&&d.info("Loading resource "+h),j.get(h).success(function(b,c,d){k.mimeType=f(d("Content-Type"))||"text/plain",t.$$setView(k,b,d,a)}).error(function(a,b,c){g.$debug&&d.error("Failed to load resource "+h),k.mimeType="$error",t.$$setView(k,new t.RouteError(a,b),c,!0)})}function r(b){var c,d;return a.isDefined(c=b.template)?a.isFunction(c)&&(c=c(b.params)):a.isDefined(d=b.templateUrl)&&(a.isFunction(d)&&(d=d(b.params)),d=b.loadedTemplateUrl||l.getTrustedResourceUrl(d),a.isDefined(d)&&(b.loadedTemplateUrl=d,c=j.get(d,{cache:k}).then(function(a){return a.data}))),c}var s=n.baseHref(),t={RouteError:b,mapViewPath:function(a){return g.mapViewPath(s,a)},mapApiUrl:function(a){return g.mapApiUrl(s,a)},isKnownType:function(a){return a&&!!h.match(f(a))},url:function(a){if(arguments.length<1)return t.mapViewPath(c.path());var b=t.mapApiUrl(a);return b?(c.path(b),a):void 0},reload:q,$$setView:function(b,c,f,i){if(b===t.next){delete t.next;var j=b.mimeType,k=t.current;if(g.$debug&&d.info("Setting view to "+j),!i&&k&&k.url===b.url&&k.mimeType===b.mimeType)return g.$debug&&d.info("Replacing current data"),o.data=c,void o.$emit("$routeDataUpdated",c);var l=h.match(j);if(l||(g.$debug&&d.warn("View "+j+" not found"),l=h.match("$error"),c=new t.RouteError("Unknown content type "+j,999)),!l)return void e.$emit("$routeChangeFailed");var n,q=a.copy(l.resolve);q?a.forEach(q,function(b,c){q[c]=a.isString(b)?p.get(b):p.invoke(b,null,null,c)}):q={},n=r(l),a.isDefined(n)&&(q.$template=n),k=t.current=a.extend(b,l),k.locals=q,q.$data=c,q.$dataType=j,q.$dataUrl=b.url,q.$dataHeaders=f,m.all(q).then(function(a){k.locals=a,t.current===k&&(o.data=c,o.type=j,o.url=b.url,o.headers=f,e.$emit("$routeChangeSuccess"))},function(){t.current===k&&e.$emit("$routeChangeFailed")})}}};return e.$on("$locationChangeSuccess",function(){q(!0)}),t}]}]),f.factory("$routeData",["$rootScope",function(a){var b=a.$new(!0);return b.$on=function(c,d,e){var f=a.$on.call(b,c,d);return e&&e.$on("$destroy",f),f},b.$attachScope=function(a){return b.$on("$routeDataUpdated",function(b,c){a.$broadcast("$routeDataUpdated",c)},a)},b}]),f.directive("dataview",["$dataRoute","$anchorScroll","$animate",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(n.remove(),n=null),l&&(l.$destroy(),l=null),m&&(d.leave(m,function(){n=null}),n=m,m=null)}function k(){var g=b.current&&b.current.locals,h=g&&g.$template;if(a.isDefined(h)){var k=e.$new(),n=b.current;m=i(k,function(b){d.enter(b,null,m||f,function(){!a.isDefined(o)||o&&!e.$eval(o)||c()}),j()}),l=n.scope=k,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}]),f.directive("dataview",["$compile","$controller","$dataRoute",function(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f.locals;e.html(g.$template);var h=a(e.contents());if(f.controller){g.$scope=d;var i=b(f.controller,g);f.controllerAs&&(d[f.controllerAs]=i),e.data("$ngControllerController",i),e.children().data("$ngControllerController",i)}h(d)}}}]),f.constant("$$DataRouterMatchMap",function(){this.$exact={},this.$matchers=[],this.addMatcher=function(b,c){a.isFunction(b)?this.$matchers.push({m:b,d:c}):b.indexOf("*")>-1?this.$matchers.push({m:d(b),d:c}):this.$exact[b]=c},this.match=function(a){var b,c,d=this.$exact[a];if(d)return d;for(c=this.$matchers,b=0;b<c.length;b++)if(c[b].m(a))return c[b].d}}),b.prototype=Object.create(Error.prototype),b.prototype.name="RouteError",b.prototype.constructor=b}(angular);
//# sourceMappingURL=angular-data-router.min.js.map