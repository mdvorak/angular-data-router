!function(a){"use strict";function b(){this.$exact={},this.$matchers=[],this.addMatcher=function(b,c){a.isFunction(b)?this.$matchers.push({m:b,d:c}):b.indexOf("*")>-1?this.$matchers.push({m:e(b),d:c}):this.$exact[b]=c},this.match=function(a){var b,c,d=this.$exact[a];if(d)return d;for(c=this.$matchers,b=0;b<c.length;b++)if(c[b].m(a))return c[b].d}}function c(a,b){this.message=a,this.status=b,this.stack=(new Error).stack}function d(){return Array.prototype.join.call(arguments,"/").replace(/\/+/g,"/")}function e(a){var b=new RegExp("^"+f(a)+"$");return function(a){return b.test(a)}}function f(a){return a.replace(/([-()\[\]{}+?.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace(/[*]+/,".*")}function g(a){return a?(a=a.replace(/\s*[\+;].*$/,""),a.indexOf("/")<0&&(a="application/"+a),a):void 0}var h=a.module("mdvorak.dataRouter",[]);h.factory("$routeData",["$rootScope",function(a){var b=a.$new(!0);return b.$on=function(c,d,e){var f=a.$on.call(b,c,d);return e&&e.$on("$destroy",f),f},b.$attachScope=function(a){if(!a)throw new Error("scope is required");return b.$on("$routeDataUpdated",function(b,c){a.$broadcast("$routeDataUpdated",c)},a)},b}]),h.provider("$dataRouterRegistry",["$logProvider","$$dataRouterMatchMap",function(b,c){var d=this,e=d.$$views=c.create(),f=a.bind(window.console,(window.console||{}).log||a.noop);d.when=function(c,h){return h=a.copy(h),a.isFunction(c)?(e.addMatcher(c,h),b.debugEnabled()&&f("Registered media type matcher "+c.name,h)):(c=g(c),e.addMatcher(c,h),b.debugEnabled()&&f("Registered media type "+c,h)),d},d.error=function(b){return e.addMatcher("$error",a.copy(b)),d},this.$get=function(){return{match:function(a){return e.match(a)}}}}]),h.factory("$dataRouterLoader",["$sce","$http","$templateCache","$q","$injector","$dataRouterRegistry",function(b,d,e,f,h,i){var j={RouteError:c,normalizeMediaType:g,loadData:function(b){return d.get(b).then(function(b){var c=g(b.headers("Content-Type"))||"text/plain",d=i.match(c);return d?{status:b.status,headers:b.headers,config:b.config,mediaType:c,data:b.data,view:d}:f.reject({status:999,data:"Unknown content type "+c,config:b.config,headers:a.noop})})},loadView:function(b){return f.when(b).then(function(b){if(b.view){var c,d=a.copy(b.view.resolve);return d?a.forEach(d,function(b,c){d[c]=a.isString(b)?h.get(b):h.invoke(b)}):d={},c=j.$$loadTemplate(b.view),a.isDefined(c)&&(d.$template=c),f.all(d).then(function(a){return a.$data=b.data,a.$dataType=b.mediaType,a.$dataUrl=b.url,a.$dataResponse=b,b.locals=a,b},function(){return f.reject({status:999,data:"Failed to resolve view "+b.mediaType,config:b.config,headers:a.noop})})}return b})},$$loadTemplate:function(c){var f,g;return a.isDefined(f=c.template)?a.isFunction(f)&&(f=f(c.params)):a.isDefined(g=c.templateUrl)&&(a.isFunction(g)&&(g=g(c.params)),g=c.loadedTemplateUrl||b.getTrustedResourceUrl(g),a.isDefined(g)&&(c.loadedTemplateUrl=g,f=d.get(g,{cache:e}).then(function(a){return a.data}))),f}};return j}]),h.provider("$dataRouter",["$$dataRouterMatchMap","$dataRouterRegistryProvider",function(b,e){var f=this,h=b.create();this.$apiPrefix="api/",this.apiPrefix=function(a){"/"!==a[a.length-1]&&(a+="/"),"/"===a[0]&&(a=a.substring(1)),f.$apiPrefix=a},this.mapViewPath=function(a,b){return d(a,f.$apiPrefix,b)},this.mapApiUrl=function(a,b){return"/"!==a[a.length-1]&&(a+="/"),0===b.indexOf(a)&&(b=b.substring(a.length)),0===b.indexOf(f.$apiPrefix)?b.substring(3):void 0},this.when=function(a,b){return e.when(a,b),this},this.error=function(b){return e.error(a.copy(b)),this},this.redirect=function(a,b){return b&&h.addMatcher(a,b),this},this.$get=["$log","$location","$rootScope","$q","$browser","$routeData","$dataRouterRegistry","$dataRouterLoader",function(a,b,d,e,i,j,k,l){var m=i.baseHref(),n={RouteError:c,mapViewPath:function(a){return f.mapViewPath(m,a)},mapApiUrl:function(a){return f.mapApiUrl(m,a)},isKnownType:function(a){return a&&!!k.match(g(a))},url:function(a){if(arguments.length<1)return n.mapViewPath(b.path());var c=n.mapApiUrl(a);return c?(b.path(c),a):void 0},reload:function(c){function e(a){n.next===m&&(n.next=void 0,n.current=a,n.$$setView(a))}function f(a,b){return a&&b&&a.url===b.url&&a.mediaType===b.mediaType}var g,i,k=b.path()||"/",m=n.next={};return(g=h.match(k))?(a.debug("Redirecting to "+g),void b.path(g).replace()):(i=n.mapViewPath(b.path()),a.debug("Loading resource "+i),void l.loadData(i).then(function(b){return n.next===m?!c&&f(n.current,b)?(a.debug("Replacing current data"),n.next=void 0,n.current=b,n.$$updateView(b),void j.$emit("$routeDataUpdated",b.data)):l.loadView(b):void 0}).then(e,function(a){return n.next===m?(a.mediaType="$error",l.loadView(a)):void 0}).then(e,function(b){n.next===m&&(a.error("Failed to load view or data and no error view defined",b),d.$emit("$routeChangeFailed"))}))},$$updateView:function(a){j.data=a.data,j.type=a.mediaType,j.url=a.url,j.headers=a.headers},$$setView:function(b){a.debug("Setting view to "+b.mediaType),n.$$updateView(b),d.$emit("$routeChangeSuccess")}};return d.$on("$locationChangeSuccess",function(){n.reload(!0)}),n}]}]),h.directive("dataview",["$dataRouter","$anchorScroll","$animate",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(n.remove(),n=null),l&&(l.$destroy(),l=null),m&&(d.leave(m,function(){n=null}),n=m,m=null)}function k(){var g=b.current&&b.current.locals,h=g&&g.$template;if(a.isDefined(h)){var k=e.$new(),n=b.current;m=i(k,function(b){d.enter(b,null,m||f,function(){!a.isDefined(o)||o&&!e.$eval(o)||c()}),j()}),l=n.scope=k,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}]),h.directive("dataview",["$compile","$controller","$dataRouter",function(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f.locals;e.html(g.$template);var h=a(e.contents());if(f.controller){g.$scope=d;var i=b(f.controller,g);f.controllerAs&&(d[f.controllerAs]=i),e.data("$ngControllerController",i),e.children().data("$ngControllerController",i)}h(d)}}}]),h.constant("$$dataRouterMatchMap",{create:function(){return new b}}),c.prototype=Object.create(Error.prototype),c.prototype.name="RouteError",c.prototype.constructor=c}(window.angular);
//# sourceMappingURL=angular-data-router.min.js.map