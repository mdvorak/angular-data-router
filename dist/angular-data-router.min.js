!function(a){"use strict";function b(){function b(a){var b=new RegExp("^"+c(a)+"$");return function(a){return b.test(a)}}function c(a){return a.replace(/([-()\[\]{}+?.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace(/[*]+/,".*")}this.$exact={},this.$matchers=[],this.addMatcher=function(c,d){a.isFunction(c)?this.$matchers.push({m:c,d:d}):c.indexOf("*")>-1?this.$matchers.push({m:b(c),d:d}):this.$exact[c]=d},this.match=function(a){var b,c,d=this.$exact[a];if(d)return d;for(c=this.$matchers,b=0;b<c.length;b++)if(c[b].m(a))return c[b].d}}var c=a.module("mdvorakDataRouter",[]);c.provider("$dataRouterRegistry",["$$dataRouterMatchMap",function(b){var c=this,d=c.$$views=b.create();c.when=function(b,e){return e=a.copy(e),a.isFunction(b)?d.addMatcher(b,e):(b=c.$$normalizeMediaType(b),d.addMatcher(b,e)),c},c.error=function(b){return d.addMatcher("$error",a.copy(b)),c},c.$$normalizeMediaType=function(a){return a?(a=a.replace(/\s*[\+;].*$/,""),a.indexOf("/")<0&&(a="application/"+a),a):void 0},this.$get=function(){return{normalizeMediaType:c.$$normalizeMediaType,match:function(a){return d.match(a)},isKnownType:function(a){return a&&!!this.match(c.$$normalizeMediaType(a))}}}}]),c.provider("$dataRouterLoader",function(){function b(b){a.extend(this,b),this.$$nextUid=1,this.$$routeUpdateListeners={}}function c(a,b,c,d){function e(){delete a[b]}if(a[b]=c,d){var f=d.$on("$destroy",e);return function(){e(),f()}}return e}var d=this,e=document.createElement("a");d.global=function(b){return b?(a.isObject(b.resolve)&&(d.$globalResolve=a.extend(d.$globalResolve||{},b.resolve)),d):void 0},d.$$normalizeUrl=function(a){return""===a?(e.setAttribute("href","X"),e.href.replace(/X$/,"")):a?(e.setAttribute("href",a),e.href):null},this.$get=["$log","$sce","$http","$templateCache","$q","$injector","$dataRouterRegistry",function(c,e,f,g,h,i,j){var k={RouteData:b,normalizeMediaType:j.normalizeMediaType,normalizeUrl:function(a){return d.$$normalizeUrl(a)},prefetchTemplate:function(a){var b=j.match(a);b?(c.debug("Pre-fetching template for "+a),k.$$loadTemplate(b,a)):c.debug("Cannot prefetch template for "+a+", type is not registered")},prepareView:function(a,d,e){function f(a){return!e&&i(d,a)?(c.debug("Replacing current data"),a.$routeDataUpdate=!0,l(a)):k.$$loadView(a).then(l)}function g(a){return a.mediaType="$error",a.view=j.match("$error"),a.$routeError=!0,a.view?k.$$loadView(a).then(l):h.reject(l(a))}function i(a,b){return a&&b&&a.url===b.url&&a.mediaType===b.mediaType}function l(a){return new b(a)}return k.$$loadData(a).then(f).then(null,g)},$$loadData:function(b){return f.get(b).then(function(b){var c=j.normalizeMediaType(b.headers("Content-Type"))||"text/plain",d=j.match(c);if(!d)return h.reject({status:999,statusText:"Application Error",data:"Unknown content type "+c,config:b.config,headers:a.noop});var e={status:b.status,statusText:b.statusText,headers:b.headers,config:b.config,mediaType:c,data:b.data,view:d};return d.transformResponse?(e.originalData=b.data,d.transformResponse(e)):e})},$$loadView:function(b){return h.when(b).then(function(b){if(b.view){var c,e=a.extend({},d.$globalResolve,b.view.resolve),f={$data:b.data,$dataType:b.mediaType,$dataUrl:b.config.url,$dataResponse:b};return e?a.forEach(e,function(b,c){e[c]=a.isString(b)?i.get(b):i.invoke(b,"$dataRouterLoader",f)}):e={},c=k.$$loadTemplate(b.view,b.mediaType),a.isDefined(c)&&(e.$template=c),h.all(e).then(function(c){return a.extend(c,f),b.locals=c,b},function(){return h.reject({status:999,statusText:"Application Error",data:"Failed to resolve view "+b.mediaType,config:b.config,headers:a.noop})})}return b})},$$loadTemplate:function(b,c){var d,h;return a.isDefined(d=b.template)?a.isFunction(d)&&(d=d(c)):a.isDefined(h=b.templateUrl)&&(a.isFunction(h)&&(h=h(c)),h=b.loadedTemplateUrl||e.getTrustedResourceUrl(h),a.isDefined(h)&&(b.loadedTemplateUrl=h,d=f.get(h,{cache:g}).then(function(a){return a.data}))),d}};return k}],b.prototype={constructor:b,on:function(b,d,e){return d&&"$routeUpdate"===b?c(this.$$routeUpdateListeners,this.$$nextUid++,d,e):a.noop},$$broadcast:function(b,c,d){if("$routeUpdate"===b){var e={name:b,preventDefault:function(){e.defaultPrevented=!0},defaultPrevented:!1};c=[e].concat(c),a.forEach(this.$$routeUpdateListeners,function(a){try{a.apply(null,c)}catch(b){d(b)}})}}}}),c.provider("$dataRouter",["$$dataRouterMatchMap","$dataRouterRegistryProvider","$dataRouterLoaderProvider",function(b,c,d){var e=this;e.$redirects=b.create(),e.$apiPrefix=d.$$normalizeUrl(""),e.apiPrefix=function(a){return arguments.length>0&&(e.$apiPrefix=d.$$normalizeUrl(a)),e.$apiPrefix},e.mapViewToApi=function(a){return a&&"/"===a[0]&&(a=a.substring(1)),e.$apiPrefix+a},e.mapApiToView=function(a){return a=d.$$normalizeUrl(a),a&&0===a.indexOf(e.$apiPrefix)?a.substring(e.$apiPrefix.length):null},e.when=function(a,b){return c.when(a,b),e},e.error=function(b){return c.error(a.copy(b)),e},e.redirect=function(a,b){return b&&e.$redirects.addMatcher(a,b),e},e.global=function(a){return d.global(a),e},this.$get=["$log","$location","$rootScope","$q","$exceptionHandler","$dataRouterRegistry","$dataRouterLoader",function(b,c,d,f,g,h,i){b.debug("Using api prefix "+e.$apiPrefix);var j={normalizeMediaType:h.normalizeMediaType,apiPrefix:function(){return e.apiPrefix()},mapViewToApi:function(a){return e.mapViewToApi(a)},mapApiToView:function(a){return e.mapApiToView(a)},isKnownType:function(a){return h.isKnownType(a)},url:function(a){if(arguments.length<1)return j.mapViewToApi(c.path());var b=j.mapApiToView(a);return b?(c.path(b),a):void 0},reload:function(f){function h(c){j.next===o&&(j.next=void 0,c.$routeDataUpdate&&j.current?(b.debug("Replacing current data"),a.extend(j.current,c),j.current.$$broadcast("$routeUpdate",[c],g)):(b.debug("Setting view to "+c.mediaType),j.current=c,d.$emit("$routeChangeSuccess",c)))}function k(a){j.next===o&&(j.next=void 0,b.error("Failed to load view or data and no error view defined",a),d.$emit("$routeChangeError",a))}var l,m,n=c.path()||"/",o=j.next={};return(l=e.$redirects.match(n))?(b.debug("Redirecting to "+l),void c.path(l).replace()):(m=j.mapViewToApi(c.path()),b.debug("Loading resource "+m),void i.prepareView(m,j.current,f).then(h,k))}};return d.$on("$locationChangeStart",function(a){d.$broadcast("$routeChangeStart").defaultPrevented&&a&&a.preventDefault()}),d.$on("$locationChangeSuccess",function(){j.reload(!0)}),j}]}]),c.constant("$$dataRouterMatchMap",{create:function(){return new b}}),c.directive("apiHref",["$dataRouter","$dataRouterLoader","$location","$browser",function(b,c,d,e){return{restrict:"AC",link:function(f,g,h){function i(a,b){h.$set("href",a),k||h.$set("target",a?b:null)}function j(){if(h.type&&!b.isKnownType(h.type))return void i(h.apiHref,"_self");var c=b.mapApiToView(h.apiHref);a.isString(c)?(d.$$html5?""===c&&(c=e.baseHref()):c="#/"+c,i(c,null)):i(h.apiHref,"_self")}var k="target"in h;h.$observe("apiHref",j),"type"in h&&(h.$observe("type",j),g.on("click",function(){h.type&&f.$applyAsync(function(){h.type&&c.prefetchTemplate(h.type)})}))}}}]),c.directive("datafragment",["$dataRouterLoader","$animate","$log",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(c.cancel(n),n=null),l&&(l.$destroy(),l=null),m&&(n=c.leave(m),n.then(function(){n=null}),m=null)}function k(h){function k(b){if(o===g.next){q.current=b,g.next=void 0;var h=b&&b.locals,k=h&&h.$template;if(a.isDefined(k)){d.debug("Setting fragment view to "+b.mediaType);var n=e.$new();m=i(n,function(a){c.enter(a,null,m||f),j()}),l=b.scope=n,l.$eval(p)}else d.debug("Resetting fragment view, got no response"),j()}}var n=g.reload?e.$eval(g.reload):!0,o=g.next={};h?b.prepareView(h,q.current,n).then(k,k):k()}var l,m,n,o=g.datafragment||g.src,p=g.onload||"",q=e.$$dataRouterCtx={};e.$watch(o,k)}}}]),c.directive("datafragment",["$compile","$controller",function(a,b){return{restrict:"ECA",priority:-400,link:function(c,d){var e=c.$$dataRouterCtx,f=e.current,g=f.view,h=f.locals;d.html(h.$template);var i=a(d.contents());if(g&&g.controller){h.$scope=c;var j=b(g.controller,h);g.controllerAs&&(c[g.controllerAs]=j),d.data("$ngControllerController",j),d.children().data("$ngControllerController",j)}g&&g.dataAs&&(h.$scope=c,c[g.dataAs]=f.data,f.on("$routeUpdate",function(a){c[g.dataAs]=a},c)),i(c)}}}]),c.directive("dataview",["$dataRouter","$anchorScroll","$animate",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(d.cancel(n),n=null),l&&(l.$destroy(),l=null),m&&(n=d.leave(m),n.then(function(){n=null}),m=null)}function k(){var g=b.current&&b.current.locals,h=g&&g.$template;if(a.isDefined(h)){var k=e.$new(),n=b.current;m=i(k,function(b){d.enter(b,null,m||f).then(function(){!a.isDefined(o)||o&&!e.$eval(o)||c()}),j()}),l=n.scope=k,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}]),c.directive("dataview",["$compile","$controller","$dataRouter",function(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f?f.view:void 0,h=f.locals;e.html(h.$template);var i=a(e.contents());if(g&&g.controller){h.$scope=d;var j=b(g.controller,h);g.controllerAs&&(d[g.controllerAs]=j),e.data("$ngControllerController",j),e.children().data("$ngControllerController",j)}g&&g.dataAs&&(h.$scope=d,d[g.dataAs]=f.data,f.on("$routeUpdate",function(a){d[g.dataAs]=a},d)),i(d)}}}])}(angular);
//# sourceMappingURL=angular-data-router.min.js.map