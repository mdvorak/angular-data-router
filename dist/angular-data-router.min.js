!function(a){"use strict";function b(){function b(a){var b=new RegExp("^"+c(a)+"$");return function(a){return b.test(a)}}function c(a){return a.replace(/([-()\[\]{}+?.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace(/[*]+/,".*")}this.$exact={},this.$matchers=[],this.addMatcher=function(c,d){a.isFunction(c)?this.$matchers.push({m:c,d:d}):c.indexOf("*")>-1?this.$matchers.push({m:b(c),d:d}):this.$exact[c]=d},this.match=function(a){var b,c,d=this.$exact[a];if(d)return d;for(c=this.$matchers,b=0;b<c.length;b++)if(c[b].m(a))return c[b].d}}var c=a.module("mdvorakDataRouter",["mdvorakApiMap"]);a.module("mdvorakApiMap",[]).provider("$apiMap",function(){var a=this,b=document.createElement("A");a.normalizeUrl=function(a){return""===a?(b.setAttribute("href","X"),b.href.replace(/X$/,"")):a?(b.setAttribute("href",a),b.href):null},a.$apiPrefix=a.normalizeUrl(""),a.prefix=function(b){return arguments.length>0&&(a.$apiPrefix=a.normalizeUrl(b)),a.$apiPrefix},a.mapViewToApi=function(b){return b&&"/"===b[0]&&(b=b.substring(1)),a.$apiPrefix+b},a.mapApiToView=function(b){return b=a.normalizeUrl(b),b&&0===b.indexOf(a.$apiPrefix)?b.substring(a.$apiPrefix.length):null},this.$get=["$log","$location",function(b,c){b.debug("Using API prefix "+a.$apiPrefix);var d={apiPrefix:function(){return a.apiPrefix()},mapViewToApi:function(b){return a.mapViewToApi(b)},mapApiToView:function(b){return a.mapApiToView(b)},url:function(a){if(arguments.length<1)return d.mapViewToApi(c.path());var b=d.mapApiToView(a);return b?(c.path(b),a):void 0},normalizeUrl:function(b){return a.normalizeUrl(b)}};return d}]}),c.provider("$dataRouterRegistry",["$$dataRouterMatchMap",function(b){var c=this,d=c.$$views=b.create();c.when=function(b,e){return e=a.copy(e),a.isFunction(b)?d.addMatcher(b,e):(b=c.normalizeMediaType(b),d.addMatcher(b,e)),c},c.error=function(b){return d.addMatcher("$error",a.copy(b)),c},c.normalizeMediaType=function(a){return a?(a=a.replace(/\s*[\+;].*$/,""),a.indexOf("/")<0&&(a="application/"+a),a):null},this.$get=function(){return{normalizeMediaType:c.normalizeMediaType,match:function(a){return d.match(a)},isKnownType:function(a){return a&&!!this.match(c.normalizeMediaType(a))}}}}]),c.provider("$dataRouterLoader",function(){var b=this;b.global=function(c){return c?(a.isObject(c.resolve)&&(b.$globalResolve=a.extend(b.$globalResolve||{},c.resolve)),b):b},this.$get=["$log","$sce","$http","$templateCache","$q","$injector","$rootScope","$dataRouterRegistry","$$dataRouterEventSupport",function(c,d,e,f,g,h,i,j,k){function l(b){return a.extend(k.$new(),b)}var m={normalizeMediaType:j.normalizeMediaType,prefetchTemplate:function(a){var b=j.match(a);b?(c.debug("Pre-fetching template for "+a),m.$$loadTemplate(b,a)):c.debug("Cannot prefetch template for "+a+", type is not registered")},prepareView:function(a,b,c){function d(a){return!c&&f(b,a)?(a.routeDataUpdate=!0,a):m.$$loadView(a)}function e(a){return a.mediaType="$error",a.view=j.match("$error"),a.routeError=!0,a.view?m.$$loadView(a):g.reject(a)}function f(a,b){return a&&b&&a.url===b.url&&a.mediaType===b.mediaType}return m.$$loadData(a).then(d).then(null,e)},$$loadData:function(b){return c.debug("Loading resource "+b),e.get(b).then(function(b){var c=j.normalizeMediaType(b.headers("Content-Type"))||"text/plain",d=j.match(c);if(!d)return g.reject(l({status:999,statusText:"Application Error",data:"Unknown content type "+c,config:b.config,headers:a.noop}));var e={status:b.status,statusText:b.statusText,headers:b.headers,config:b.config,mediaType:c,data:b.data,view:d};return d.transformResponse?(e.originalData=b.data,l(d.transformResponse(e))):l(e)})},$$loadView:function(c){return g.when(c).then(function(c){if(c.view){var d,e=a.extend({},b.$globalResolve,c.view.resolve),f={$data:c.data,$dataType:c.mediaType,$dataUrl:c.config.url,$dataResponse:c};return e?a.forEach(e,function(b,c){e[c]=a.isString(b)?h.get(b):h.invoke(b,"$dataRouterLoader",f)}):e={},d=m.$$loadTemplate(c.view,c.mediaType),a.isDefined(d)&&(e.$template=d),g.all(e).then(function(b){return a.extend(b,f),c.locals=b,c},function(){return g.reject(l({status:999,statusText:"Application Error",data:"Failed to resolve view "+c.mediaType,config:c.config,headers:a.noop}))})}return c})},$$loadTemplate:function(b,c){var g,h;return a.isDefined(g=b.template)?a.isFunction(g)&&(g=g(c)):a.isDefined(h=b.templateUrl)&&(a.isFunction(h)&&(h=h(c)),h=b.loadedTemplateUrl||d.getTrustedResourceUrl(h),a.isDefined(h)&&(b.loadedTemplateUrl=h,g=e.get(h,{cache:f}).then(function(a){return a.data}))),g}};return m}]}),c.provider("$dataRouter",["$$dataRouterMatchMap","$dataRouterRegistryProvider","$dataRouterLoaderProvider","$apiMapProvider",function(b,c,d,e){var f=this;f.$enabled=!0,f.$redirects=b.create(),f.apiPrefix=function(a){return e.prefix(a)},f.when=function(a,b){return c.when(a,b),f},f.error=function(b){return c.error(a.copy(b)),f},f.redirect=function(a,b){return b&&f.$redirects.addMatcher(a,b),f},f.global=function(a){return d.global(a),f},f.enabled=function(a){return f.$enabled=!!a,f},this.$get=["$log","$location","$rootScope","$q","$dataRouterRegistry","$dataRouterLoader","$apiMap",function(b,c,d,e,g,h,i){var j={api:i,registry:g,reload:function(e){function g(c){if(j.$$next===o)if(j.$$next=void 0,c.routeDataUpdate&&j.current){b.debug("Replacing current data");var e=j.current.$$listeners;a.extend(j.current,c),j.current.$$listeners=e,j.current.$broadcast("$routeUpdate",j.current)}else b.debug("Setting view to "+c.mediaType),c.reload=j.reload,j.current=c,d.$broadcast("$routeChangeSuccess",c)}function k(a){j.$$next===o&&(j.$$next=void 0,b.error("Failed to load view or data and no error view defined",a),d.$broadcast("$routeChangeError",a))}var l,m,n=c.path()||"/",o=j.$$next={};return(l=f.$redirects.match(n))?(b.debug("Redirecting to "+l),void c.path(l).replace()):(m=i.mapViewToApi(c.path()),b.debug("Loading main view"),void h.prepareView(m,j.current,e).then(g,k))}};return f.$enabled&&(d.$on("$locationChangeStart",function(a){d.$broadcast("$routeChangeStart").defaultPrevented&&a&&a.preventDefault()}),d.$on("$locationChangeSuccess",function(){j.reload(!0)})),j}]}]),c.constant("$$dataRouterMatchMap",{create:function(){return new b}}),c.factory("$$dataRouterEventSupport",["$exceptionHandler",function(a){function b(){}var c=[].slice;return b.$new=function(){return new b},b.prototype={constructor:b,$on:function(a,b,c){this.$$listeners||(this.$$listeners={});var d=this.$$listeners[a];d?d.push(b):d=this.$$listeners[a]=[b];var e=function(){var a=d.indexOf(b);-1!==a&&(d[a]=null)};if(c){var f=c.$on("$destroy",e);return function(){e(),f()}}return e},$broadcast:function(b,d){var e,f,g={name:b,preventDefault:function(){g.defaultPrevented=!0},defaultPrevented:!1},h=this.$$listeners&&this.$$listeners[b]||[];for(d=[g].concat(c.call(arguments,1)),e=0,f=h.length;f>e;e++)if(h[e])try{h[e].apply(null,d)}catch(i){a(i)}else h.splice(e,1),e--,f--;return g}},b}]),c.directive("apiHref",["$apiMap","$dataRouterRegistry","$dataRouterLoader","$location","$browser",function(b,c,d,e,f){return{restrict:"AC",link:function(g,h,i){function j(a,b){i.$set("href",a),l||i.$set("target",a?b:null)}function k(){if(i.type&&!c.isKnownType(i.type))return void j(i.apiHref,"_self");var d=b.mapApiToView(i.apiHref);a.isString(d)?(e.$$html5?""===d&&(d=f.baseHref()):d="#/"+d,j(d,null)):j(i.apiHref,"_self")}var l="target"in i;i.$observe("apiHref",k),"type"in i&&(i.$observe("type",k),h.on("click",function(){i.type&&g.$applyAsync(function(){i.type&&d.prefetchTemplate(i.type)})}))}}}]),c.directive("datafragment",["$dataRouterLoader","$animate","$log",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){p&&(c.cancel(p),p=null),n&&(n.$destroy(),n=null),o&&(p=c.leave(o),p.then(function(){p=null}),o=null)}function k(a){m=a,l(!0)}function l(h){function k(b){if(p===g.next)if(b.routeDataUpdate&&s.current){d.debug("Replacing fragments data");var h=s.current.$$listeners;a.extend(s.current,b),s.current.$$listeners=h,s.current.$broadcast("$routeUpdate",s.current)}else{s.current=b,g.next=void 0;var k=b&&b.locals,m=k&&k.$template;if(a.isDefined(m)){d.debug("Setting fragment view to "+b.mediaType),b.reload=l;var q=e.$new();o=i(q,function(a){c.enter(a,null,o||f),j()}),n=b.scope=q,n.$eval(r)}else d.debug("Resetting fragment view, got no response"),j()}}var p=g.next={};m?(d.debug("Loading fragment view for ",f[0]),b.prepareView(m,s.current,h).then(k,k)):k()}var m,n,o,p,q=g.datafragment||g.src,r=g.onload||"",s=e.$$dataRouterCtx={};e.$watch(q,k)}}}]),c.directive("datafragment",["$compile","$controller",function(a,b){return{restrict:"ECA",priority:-400,link:function(c,d){var e=c.$$dataRouterCtx,f=e.current,g=f.view,h=f.locals;d.html(h.$template);var i=a(d.contents());if(g&&g.controller){h.$scope=c;var j=b(g.controller,h);g.controllerAs&&(c[g.controllerAs]=j),d.data("$ngControllerController",j),d.children().data("$ngControllerController",j)}g&&g.dataAs&&(h.$scope=c,c[g.dataAs]=f.data,f.$on("$routeUpdate",function(a,b){c[g.dataAs]=b.data},c)),i(c)}}}]),c.directive("dataview",["$dataRouter","$anchorScroll","$animate",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(d.cancel(n),n=null),l&&(l.$destroy(),l=null),m&&(n=d.leave(m),n.then(function(){n=null}),m=null)}function k(){var g=b.current&&b.current.locals,h=g&&g.$template;if(a.isDefined(h)){var k=e.$new(),n=b.current;m=i(k,function(b){d.enter(b,null,m||f).then(function(){!a.isDefined(o)||o&&!e.$eval(o)||c()}),j()}),l=n.scope=k,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}]),c.directive("dataview",["$compile","$controller","$dataRouter",function(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f?f.view:void 0,h=f.locals;e.html(h.$template);var i=a(e.contents());if(g&&g.controller){h.$scope=d;var j=b(g.controller,h);g.controllerAs&&(d[g.controllerAs]=j),e.data("$ngControllerController",j),e.children().data("$ngControllerController",j)}g&&g.dataAs&&(h.$scope=d,d[g.dataAs]=f.data,f.$on("$routeUpdate",function(a,b){d[g.dataAs]=b.data},d)),i(d)}}}])}(angular);
//# sourceMappingURL=angular-data-router.min.js.map