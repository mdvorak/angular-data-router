!function(a){"use strict";function b(){this.$exact={},this.$matchers=[],this.addMatcher=function(b,c){a.isFunction(b)?this.$matchers.push({m:b,d:c}):b.indexOf("*")>-1?this.$matchers.push({m:d(b),d:c}):this.$exact[b]=c},this.match=function(a){var b,c,d=this.$exact[a];if(d)return d;for(c=this.$matchers,b=0;b<c.length;b++)if(c[b].m(a))return c[b].d}}function c(a,b){this.message=a,this.status=b,this.stack=(new Error).stack}function d(a){var b=new RegExp("^"+e(a)+"$");return function(a){return b.test(a)}}function e(a){return a.replace(/([-()\[\]{}+?.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace(/[*]+/,".*")}function f(a){return a?(a=a.replace(/\s*[\+;].*$/,""),a.indexOf("/")<0&&(a="application/"+a),a):void 0}var g=a.module("mdvorakDataRouter",[]);g.factory("$routeData",["$rootScope","$injector",function(a,b){var c,d=a.$new(!0);return d.onRouteDataUpdated=function(a,b){var c=d.$on("$routeUpdate",a);if(b){var e=b.$on("$destroy",c);return function(){c(),e()}}return c},d.reload=function(){c||(c=b.get("$dataRouter","$routeData")),c.reload(!1)},d}]),g.provider("$dataRouterRegistry",["$$dataRouterMatchMap",function(b){var d=this,e=d.$$views=b.create();d.when=function(b,c){return c=a.copy(c),a.isFunction(b)?e.addMatcher(b,c):(b=f(b),e.addMatcher(b,c)),d},d.error=function(b){return e.addMatcher("$error",a.copy(b)),d},this.$get=function(){return{RouteError:c,normalizeMediaType:f,match:function(a){return e.match(a)},isKnownType:function(a){return a&&!!this.match(f(a))}}}}]),g.provider("$dataRouterLoader",function(){var b=this,d=document.createElement("a");b.global=function(c){return c?(a.isObject(c.resolve)&&(b.$globalResolve=a.extend(b.$globalResolve||{},c.resolve)),b):void 0},b.$$normalizeUrl=function(a){return""===a?(d.setAttribute("href","X"),d.href.replace(/\/X$/,"")):a?(d.setAttribute("href",a),d.href):null},this.$get=["$log","$sce","$http","$templateCache","$q","$injector","$dataRouterRegistry",function(d,e,g,h,i,j,k){var l={RouteError:c,normalizeMediaType:f,prefetchTemplate:function(a){var b=k.match(a);b?(d.debug("Prefetching template for "+a),l.$$loadTemplate(b,a)):d.debug("Cannot prefetch template for "+a+", type is not registered")},prepareView:function(a,b,c){function e(a){return!c&&g(b,a)?(d.debug("Replacing current data"),a.$routeDataUpdate=!0,a):l.$$loadView(a)}function f(a){return a.mediaType="$error",a.view=k.match("$error"),a.$routeError=!0,a.view?l.$$loadView(a):i.reject(a)}function g(a,b){return a&&b&&a.url===b.url&&a.mediaType===b.mediaType}return l.$$loadData(a).then(e).then(null,f)},$$loadData:function(b){return g.get(b).then(function(b){var c=f(b.headers("Content-Type"))||"text/plain",d=k.match(c);if(!d)return i.reject({status:999,statusText:"Application Error",data:"Unknown content type "+c,config:b.config,headers:a.noop});var e={status:b.status,statusText:b.statusText,headers:b.headers,config:b.config,mediaType:c,data:b.data,view:d};return d.transformResponse?d.transformResponse(e):e})},$$loadView:function(c){return i.when(c).then(function(c){if(c.view){var d,e=a.extend({},b.$globalResolve,c.view.resolve),f={$data:c.data,$dataType:c.mediaType,$dataUrl:c.config.url,$dataResponse:c};return e?a.forEach(e,function(b,c){e[c]=a.isString(b)?j.get(b):j.invoke(b,"$dataRouterLoader",f)}):e={},d=l.$$loadTemplate(c.view,c.mediaType),a.isDefined(d)&&(e.$template=d),i.all(e).then(function(b){return a.extend(b,f),c.locals=b,c},function(){return i.reject({status:999,statusText:"Application Error",data:"Failed to resolve view "+c.mediaType,config:c.config,headers:a.noop})})}return c})},$$normalizeUrl:function(a){return b.$$normalizeUrl(a)},$$loadTemplate:function(b,c){var d,f;return a.isDefined(d=b.template)?a.isFunction(d)&&(d=d(c)):a.isDefined(f=b.templateUrl)&&(a.isFunction(f)&&(f=f(c)),f=b.loadedTemplateUrl||e.getTrustedResourceUrl(f),a.isDefined(f)&&(b.loadedTemplateUrl=f,d=g.get(f,{cache:h}).then(function(a){return a.data}))),d}};return l}]}),g.provider("$dataRouter",["$$dataRouterMatchMap","$dataRouterRegistryProvider","$dataRouterLoaderProvider",function(b,d,e){var g=this;g.$redirects=b.create(),g.$apiPrefix=e.$$normalizeUrl(""),g.apiPrefix=function(a){return arguments.length>0&&(g.$apiPrefix=e.$$normalizeUrl(a)),g.$apiPrefix},g.mapViewToApi=function(a){return a&&"/"===a[0]&&(a=a.substring(1)),g.$apiPrefix+a},g.mapApiToView=function(a){return a=e.$$normalizeUrl(a),a&&0===a.indexOf(g.$apiPrefix)?a.substring(g.$apiPrefix.length):null},g.when=function(a,b){return d.when(a,b),g},g.error=function(b){return d.error(a.copy(b)),g},g.redirect=function(a,b){return b&&g.$redirects.addMatcher(a,b),g},g.global=function(a){return e.global(a),g},this.$get=["$log","$location","$rootScope","$q","$routeData","$dataRouterRegistry","$dataRouterLoader",function(a,b,d,e,h,i,j){var k={normalizeMediaType:f,RouteError:c,mapViewToApi:function(a){return g.mapViewToApi(a)},mapApiToView:function(a){return g.mapApiToView(a)},isKnownType:function(a){return i.isKnownType(a)},onRouteDataUpdated:function(a,b){h.onRouteDataUpdated(a,b)},url:function(a){if(arguments.length<1)return k.mapViewToApi(b.path());var c=k.mapApiToView(a);return c?(b.path(c),a):void 0},reload:function(c){function e(b){k.next===n&&(k.next=void 0,k.current=b,k.$$updateView(b),b.$routeDataUpdate?(a.debug("Replacing current data"),h.$emit("$routeUpdate",b)):(a.debug("Setting view to "+b.mediaType),d.$emit("$routeChangeSuccess",b)))}function f(b){k.next===n&&(k.next=void 0,a.error("Failed to load view or data and no error view defined",b),d.$emit("$routeChangeFailed",b))}var i,l,m=b.path()||"/",n=k.next={};return(i=g.$redirects.match(m))?(a.debug("Redirecting to "+i),void b.path(i).replace()):(l=k.mapViewToApi(b.path()),a.debug("Loading resource "+l),void j.prepareView(l,k.current,c).then(e,f))},$$updateView:function(a){h.data=a.data,h.type=a.mediaType,h.url=a.config.url,h.headers=a.headers}};return d.$on("$locationChangeStart",function(a){d.$broadcast("$routeChangeStart").defaultPrevented&&a&&a.preventDefault()}),d.$on("$locationChangeSuccess",function(){k.reload(!0)}),k}]}]),g.directive("dataview",["$dataRouter","$anchorScroll","$animate",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(d.cancel(n),n=null),l&&(l.$destroy(),l=null),m&&(n=d.leave(m),n.then(function(){n=null}),m=null)}function k(){var g=b.current&&b.current.locals,h=g&&g.$template;if(a.isDefined(h)){var k=e.$new(),n=b.current;m=i(k,function(b){d.enter(b,null,m||f).then(function(){!a.isDefined(o)||o&&!e.$eval(o)||c()}),j()}),l=n.scope=k,l.$emit("$viewContentLoaded"),l.$eval(p)}else j()}var l,m,n,o=g.autoscroll,p=g.onload||"";e.$on("$routeChangeSuccess",k),k()}}}]),g.directive("dataview",["$compile","$controller","$dataRouter",function(a,b,c){return{restrict:"ECA",priority:-400,link:function(d,e){var f=c.current,g=f?f.view:void 0,h=f.locals;e.html(h.$template);var i=a(e.contents());if(g&&g.controller){h.$scope=d;var j=b(g.controller,h);g.controllerAs&&(d[g.controllerAs]=j),e.data("$ngControllerController",j),e.children().data("$ngControllerController",j)}g&&g.dataAs&&(h.$scope=d,d[g.dataAs]=f.data,c.onRouteDataUpdated(function(a){d[g.dataAs]=a},d)),i(d)}}}]),g.directive("datafragment",["$dataRouterLoader","$animate","$log",function(b,c,d){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(e,f,g,h,i){function j(){n&&(c.cancel(n),n=null),l&&(l.$destroy(),l=null),m&&(n=c.leave(m),n.then(function(){n=null}),m=null)}function k(h){function k(b){if(o===g.next){e.$dataCurrent=b,g.next=void 0;var h=b&&b.locals,k=h&&h.$template;if(a.isDefined(k)){d.debug("Setting fragment view to "+b.mediaType);var n=e.$new();m=i(n,function(a){c.enter(a,null,m||f),j()}),l=b.scope=n,l.$eval(p)}else d.debug("Resetting fragment view, got no response"),j()}}var n=g.reload?e.$eval(g.reload):!0,o=g.next={};h?b.prepareView(h,e.$dataCurrent,n).then(k,k):k()}var l,m,n,o=g.datafragment||g.src,p=g.onload||"";e.$watch(o,k)}}}]),g.directive("datafragment",["$compile","$controller",function(a,b){return{restrict:"ECA",priority:-400,link:function(c,d){var e=c.$dataCurrent,f=e.view,g=e.locals;d.html(g.$template);var h=a(d.contents());if(f&&f.controller){g.$scope=c;var i=b(f.controller,g);f.controllerAs&&(c[f.controllerAs]=i),d.data("$ngControllerController",i),d.children().data("$ngControllerController",i)}f&&f.dataAs&&(g.$scope=c,c[f.dataAs]=e.data),h(c)}}}]),g.directive("apiHref",["$dataRouter","$dataRouterLoader","$location",function(a,b,c){return{restrict:"AC",link:function(d,e,f){function g(a,b){f.$set("href",a),i||f.$set("target",a?b:null)}function h(){if(f.type&&!a.isKnownType(f.type))return void g(f.apiHref,"_self");var b=a.mapApiToView(f.apiHref);b?(c.$$html5||(b="#"+b),g(b,null)):g(f.apiHref,"_self")}var i="target"in f;f.$observe("apiHref",h),"type"in f&&(f.$observe("type",h),e.on("click",function(){f.type&&d.$applyAsync(function(){f.type&&b.prefetchTemplate(f.type)})}))}}}]),g.constant("$$dataRouterMatchMap",{create:function(){return new b}}),c.prototype=Object.create(Error.prototype),c.prototype.name="RouteError",c.prototype.constructor=c}(window.angular);
//# sourceMappingURL=angular-data-router.min.js.map