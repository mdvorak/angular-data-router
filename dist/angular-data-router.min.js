/*
 angular-data-router v0.3.10
 (c) 2017 Michal Dvorak https://github.com/mdvorak/angular-data-router
 License: MIT
*/
!function(a){"use strict";function b(){function b(a){var b=new RegExp("^"+c(a)+"$");return function(a){return b.test(a)}}function c(a){return a.replace(/([-()\[\]{}+.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08").replace(/[*]+/g,".*").replace(/[?]/g,".")}this.$exact=Object.create(null),this.$matchers=[];var d=/[*?]/;this.addMatcher=function(c,e){a.isFunction(c)?this.$matchers.push({m:c,d:e}):d.test(c)?this.$matchers.push({m:b(c),d:e}):this.$exact[c]=e},this.match=function(a){var b,c,d=this.$exact[a];if(d)return d;for(c=this.$matchers,b=0;b<c.length;b++)if(c[b].m(a))return c[b].d}}var c=a.module("mdvorakDataRouter",["mdvorakDataApi"]);c.provider("$dataRouterRegistry",["$$dataRouterMatchMap",function(b){var c=this,d=c.$$views=b.create(),e=/^(\S+)(\s+as\s+(\w+))?$/;c.$$parseConfig=function(b,c){if(b=a.copy(b),a.isString(b.controller)){var d=b.controller.match(e);if(!d)throw new Error("Badly formed controller string '"+b.controller+"' for route '"+c+"'.");if(d[3]&&b.controllerAs)throw new Error("Defined both controllerAs and 'controller as' expressions for route '"+c+"'.");b.controller=d[1],d[3]&&(b.controllerAs=d[3])}return b},c.when=function(b,e){return e=c.$$parseConfig(e,b),a.isFunction(b)?d.addMatcher(b,e):(b=c.normalizeMediaType(b),d.addMatcher(b,e)),c},c.error=function(b,e){var f="$error";return a.isObject(b)?e=b:f="$error_"+b,d.addMatcher(f,c.$$parseConfig(e,f)),c},c.normalizeMediaType=function(a){return a?(a=a.replace(/\s*[\+;].*$/,""),a.indexOf("/")<0&&(a="application/"+a),a):null},this.$get=function(){return{normalizeMediaType:c.normalizeMediaType,match:function(a){return d.match(a)},isKnownType:function(a){return a&&!!this.match(c.normalizeMediaType(a))}}}}]),c.provider("$dataRouterLoader",function(){function b(b){b||(b=Object.create(null));for(var d=1;d<arguments.length;d++){var e=arguments[d];if(e)for(var f=Object.keys(e),g=0;g<f.length;g++){var h=f[g];if(a.isUndefined(e[h]))return;var i=b[h];c(i)&&c(e[h])?b[h]=a.extend(i,e[h]):b[h]=e[h]}}return b}function c(b){return a.isObject(b)&&"[object Object]"===e.call(b)}var d=this,e=Object.prototype.toString;d.globals=Object.create(null),d.global=function(a){return a?(d.globals=b(d.globals,a),d):d},d.extractType=function(a){return a.headers("Content-Type")},d.responseExtensions={dataAs:function(b,c,d){var e=this;b[c]=e.data,this.$on("$routeUpdate",function(){b[c]=e.data,a.isFunction(d)&&d(e.data)},b)}},this.$get=["$log","$sce","$http","$templateCache","$q","$injector","$rootScope","$dataRouterRegistry","$$dataRouterEventSupport",function(c,e,f,g,h,i,j,k,l){function m(b){return a.extend(l.$new(),b,d.responseExtensions)}var n={normalizeMediaType:k.normalizeMediaType,extractType:function(a){return k.normalizeMediaType(d.extractType(a))},prefetchTemplate:function(a){var b=k.match(a);b?(c.debug("Pre-fetching template for "+a),n.$$loadTemplate(b,a)):c.debug("Cannot prefetch template for "+a+", type is not registered")},prepareView:function(a,b,c){function d(a){return!c&&f(b,a)?(a.routeDataUpdate=!0,a):n.$$loadView(a)}function e(a){return a.routeError=!0,a.type="$error_"+a.status,a.view=k.match(a.type),a.view||(a.type="$error",a.view=k.match("$error")),a.view?n.$$loadView(a):h.reject(a)}function f(a,b){return a&&b&&a.url===b.url&&a.type===b.type}return n.$$loadData(a).then(d).then(null,e)},$$loadData:function(a){return c.debug("Loading resource "+a),f({url:a,method:"GET",dataRouter:!0}).then(function(c){var e=k.normalizeMediaType(d.extractType(c))||"application/octet-stream",f=k.match(e);if(!f)return h.reject(m({url:a,status:999,statusText:"Application Error",data:"Unknown content type "+e,config:c.config,headers:c.headers,type:e}));f=b(Object.create(null),d.globals,f);var g={url:a,status:c.status,statusText:c.statusText,headers:c.headers,config:c.config,type:e,data:c.data,view:f};return m(f.transformResponse?f.transformResponse(g):g)},function(b){return b.url=a,h.reject(m(b))})},$$loadView:function(b){return h.when(b).then(function(b){if(b.view){var c,e=a.extend(Object.create(null),d.globals.resolve,b.view.resolve),f={$data:b.data,$dataType:b.type,$dataUrl:b.url,$dataResponse:b};return e?a.forEach(e,function(b,c){e[c]=a.isString(b)?i.get(b):i.invoke(b,"$dataRouterLoader",f)}):e=Object.create(null),c=n.$$loadTemplate(b.view,b.type),a.isDefined(c)&&(e.$template=c),h.all(e).then(function(c){return a.extend(c,f),b.locals=c,b},function(){return h.reject(m({url:b.url,status:999,statusText:"Application Error",data:"Failed to resolve view "+b.type,config:{},headers:a.noop}))})}return b})},$$loadTemplate:function(b,c){var d,h;return a.isDefined(d=b.template)?a.isFunction(d)&&(d=d(c)):a.isDefined(h=b.templateUrl)&&(a.isFunction(h)&&(h=h(c)),h=b.loadedTemplateUrl||e.getTrustedResourceUrl(h),a.isDefined(h)&&(b.loadedTemplateUrl=h,d=f.get(h,{cache:g}).then(function(a){return a.data}))),d}};return n}],d.$$mergeConfigObjects=b}),c.provider("$dataRouter",["$$dataRouterMatchMap","$dataRouterRegistryProvider","$dataRouterLoaderProvider","$dataApiProvider",function(a,b,c,d){var e=this;e.$enabled=!0,e.$redirects=a.create(),e.apiPrefix=function(a){return d.prefix(a)},e.when=function(a,c){return b.when(a,c),e},e.error=function(a,c){return b.error(a,c),e},e.redirect=function(a,b){return b&&e.$redirects.addMatcher(a,b),e},e.global=function(a){return c.global(a),e},e.enabled=function(a){return e.$enabled=!!a,e},this.$get=["$log","$location","$rootScope","$q","$dataRouterRegistry","$dataRouterLoader","$dataApi","$$dataRouterEventSupport",function(a,b,c,d,f,g,h,i){var j={api:h,registry:f,current:void 0,url:function(a,b){return arguments.length<1?h.url():(b&&h.url()==a?j.reload(!0):h.url(a),a)},navigate:function(a,b){j.url(a,!1!==b)},reload:function(d){function f(b){j.$$next===n&&(j.$$next=void 0,b.routeDataUpdate&&j.current?(a.debug("Replacing current data"),i.$$extend(j.current,b),j.current.$broadcast("$routeUpdate",j.current)):(a.debug("Setting view to "+b.mediaType),b.reload=j.reload,b.navigate=j.navigate,j.current=b,c.$broadcast("$routeChangeSuccess",b)))}function k(b){j.$$next===n&&(j.$$next=void 0,a.error("Failed to load view or data and no error view defined",b),c.$broadcast("$routeChangeError",b))}var l;if(l=e.$redirects.match(b.url()||"/"))return a.debug("Redirecting to "+l),void b.url(l).replace();var m=h.url(),n=j.$$next={};a.debug("Loading main view"),g.prepareView(m,j.current,d).then(f,k)}};return e.$enabled&&(c.$on("$locationChangeStart",function(a){c.$broadcast("$routeChangeStart").defaultPrevented&&a&&a.preventDefault()}),c.$on("$locationChangeSuccess",function(){j.reload(!0)})),j}]}]),c.constant("$$dataRouterMatchMap",{create:function(){return new b}}),c.factory("$$dataRouterEventSupport",["$exceptionHandler",function(b){function c(){}var d=[].slice;return c.$new=function(){return new c},c.$$extend=function(b,c){var d=b.$$listeners;return a.extend(b,c),b.$$listeners=d,b},c.prototype={constructor:c,$on:function(a,b,c){this.$$listeners||(this.$$listeners=Object.create(null));var d=this.$$listeners[a];d?d.push(b):d=this.$$listeners[a]=[b];var e=function(){var a=d.indexOf(b);-1!==a&&(d[a]=null)};if(c){var f=c.$on("$destroy",e);return function(){e(),f()}}return e},$broadcast:function(a,c){var e,f,g={name:a,preventDefault:function(){g.defaultPrevented=!0},defaultPrevented:!1},h=this.$$listeners&&this.$$listeners[a]||[];for(c=[g].concat(d.call(arguments,1)),e=0,f=h.length;e<f;e++)if(h[e])try{h[e].apply(null,c)}catch(i){b(i)}else h.splice(e,1),e--,f--;return g}},c}]),c.directive("apiHref",["$dataApi","$dataRouterRegistry","$dataRouterLoader","$location","$browser","$parse",function(b,c,d,e,f,g){function h(h,i,j){function k(a,b){j.$set("href",a),m||j.$set("target",a?b:null)}function l(){var d=n(h);if(j.type&&!c.isKnownType(j.type))return void k(d,"_self");if(a.isString(d)){var g=b.mapApiToView(d);if(!a.isString(g))return void k(d,"_self");e.$$html5?""===g&&(g=f.baseHref()):g="#/"+g,k(g,null)}else k()}var m="target"in j,n=g(j.apiHref),o=h.$watch(j.apiHref,l);i.on("$destroy",o),j.apiType&&h.$watch(j.apiType,function(a){j.$set("type",a)}),j.$observe("type",l),i.on("click",function(){j.type&&j.href&&h.$applyAsync(function(){j.type&&d.prefetchTemplate(j.type)})})}return{restrict:"AC",priority:90,compile:function(a,b){return b.href=null,h}}}]),c.directive("dataview",["$animate","$anchorScroll","$log","$parse","$dataRouterLoader","$dataRouter","$$dataRouterEventSupport",function(b,c,d,e,f,g,h){return{restrict:"EAC",terminal:!0,priority:400,transclude:"element",link:function(i,j,k,l,m){function n(){t&&(b.cancel(t),t=null),r&&(r.$destroy(),r=null),s&&(t=b.leave(s),t.then(function(){t=null}),s=null)}function o(){var e=u.current&&u.current.locals,f=e&&e.$template;if(a.isDefined(f)){d.debug("Setting view ",j[0]," to ",u.current.type);var g=i.$new();g.$$dataRouterCtx=u,g.$viewType=k.type||"default",s=m(g,function(d){b.enter(d,null,s||j).then(function(){!a.isDefined(v)||v&&!i.$eval(v)||c()}),n()}),r=u.current.scope=g,r.$eval(w)}else d.debug("Resetting view ",j[0],", got no response"),n()}function p(a){function b(a){c===k.next&&(a&&a.routeDataUpdate&&u.current?(d.debug("Replacing view data of ",j[0]),h.$$extend(u.current,a),u.current.$broadcast("$routeUpdate",u.current)):(u.current=a,k.next=void 0,a&&(a.reload=p,a.navigate=function(){u.navigate.apply(u,arguments)}),o()))}var c=k.next=Object.create(null);q?(d.debug("Loading view data of ",j[0]),f.prepareView(q,u.current,a).then(b,b)):b()}var q,r,s,t,u,v=k.autoscroll,w=k.onload||"";k.hasOwnProperty("src")?(u={reload:p,navigate:function(a,b){q==a?!1!==b&&p(!0):(q=a,p(!0))}},i.$watch(k.src,function(a){q=a,p(!0)})):(u=g,i.$on("$routeChangeSuccess",o)),k.name&&e(k.name).assign(i,u)}}}]),c.directive("dataview",["$compile","$controller",function(a,b){return{restrict:"EAC",priority:-400,link:function(c,d){var e=c.$$dataRouterCtx,f=e.current,g=f.view,h=f.locals;delete c.$$dataRouterCtx,d.html(h.$template);var i=a(d.contents());if(g&&(d.data("$dataResponse",f),g.dataAs&&(c[g.dataAs]=f.data,f.$on("$routeUpdate",function(a,b){c[g.dataAs]=b.data},c)),g.responseAs&&(c[g.responseAs]=f),g.controller)){h.$scope=c,h.$viewType=c.$viewType;var j=b(g.controller,h);g.controllerAs&&(c[g.controllerAs]=j),d.data("$ngControllerController",j),d.children().data("$ngControllerController",j)}i(c)}}}]),c.directive("emptyHref",["$log",function(b){return{restrict:"AC",priority:0,link:function(c,d,e){function f(a){a.preventDefault()}var g;switch(a.lowercase(e.emptyHref)){case"hide":g=function(a){d.toggleClass("ng-hide",!a&&""!==a)};break;case"disable":case"disabled":g=function(a,b){""===a&&(a=!0),""===b&&(b=!0),a&&!b?d.removeClass("disabled").off("click",f):!a&&b&&d.addClass("disabled").on("click",f)},e.href||""===e.href||d.addClass("disabled").on("click",f);break;default:return void b.warn("Unsupported empty-href value: "+e.emptyHref)}e.$observe("href",g)}}}]),c.directive("entryPointHref",["$browser","$location",function(a,b){var c=b.$$html5?a.baseHref():"#/";return{restrict:"AC",priority:90,compile:function(a,b){return b.href=null,function(a,b,d){d.$set("href",c)}}}}]),a.module("mdvorakDataApi",[]).provider("$dataApi",function(){var a=this,b=document.createElement("A");a.normalizeUrl=function(a){return""===a?(b.setAttribute("href","X"),b.href.replace(/X$/,"")):a?(b.setAttribute("href",a),b.href):null},a.$apiPrefix=a.normalizeUrl(""),a.prefix=function(b){return arguments.length>0&&(a.$apiPrefix=a.normalizeUrl(b)),a.$apiPrefix},a.mapViewToApi=function(b){return b&&"/"===b[0]&&(b=b.substring(1)),a.$apiPrefix+b},a.mapApiToView=function(b){return b=a.normalizeUrl(b),b&&0===b.indexOf(a.$apiPrefix)?b.substring(a.$apiPrefix.length):null},this.$get=["$log","$location",function(b,c){return b.debug("Using API prefix "+a.$apiPrefix),{prefix:function(){return a.prefix()},mapViewToApi:function(b){return a.mapViewToApi(b)},mapApiToView:function(b){return a.mapApiToView(b)},url:function(d){if(arguments.length<1)return a.mapViewToApi(c.url());var e=a.mapApiToView(d);if(e)return c.url(e),d;b.warn("Cannot navigate to URL "+d+", it cannot be mapped to the API")},normalizeUrl:function(b){return a.normalizeUrl(b)}}}]})}(angular);
//# sourceMappingURL=angular-data-router.min.js.map